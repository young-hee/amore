<html ap:decorate="~{layout/layout-contents}" th:with="_jsfile='beautizen_recruit'">
<body>
<!-- #ap_container -->
<div ap:fragment="layout-contents">
	
	<div class="ap_contents brand beautizen_recruit_reserve">
		<div class="beautizen">
			<!-- tab menu wrap -->
			<div class="ui_tab">
				<!-- tab menu -->
				<div class="tab_menu equally">
					<ul>
						<li><a href="#none">뷰티즌이란?</a></li>
						<li class="on"><a href="#none">뷰티즌 모집</a></li>
						<li><a href="#none">뷰티즌 프로필</a></li>
					</ul>
				</div>
				<!-- tab content -->
				<div class="tab_cont no_padding">
					<h3 class="sr_only">뷰티즌 모집</h3>
					<form class="validate" id="validate" name="validate" method="post" enctype="multipart/form-data" novalidate="novalidate">
					<div class="panel">
						<h4 class="h_title page">지원서 작성</h4>
						<p class="font_md">아래 내용을 입력해주세요.</p>
						<hr class="div m30">
						<fieldset class="form">
							<legend class="sr_only">사진 입력</legend>
							<!-- 사진 첨부 -->
							<div class="attach_photo ui_input_images" data-single-input="true">
								<div class="img attach">
									<!-- 이미지 등록 -->
								</div>
								<label for="attach_photo"><span class="sr_only">사진 선택</span></label>
								<input type="file" id="attach_photo" name="picture" multiple="multiple" accept="image/gif,image/jpeg,image/jpg,image/png" required="required" data-msg-required="사진을 등록하세요.">
								<br>
								<p class="text_center">사진을 등록하시려면 터치해주세요.<br>120X160 최적화</p>
							</div>
						</fieldset>
					</div>
					<div class="panel">
						<fieldset class="form">
							<legend class="sr_only">기본정보 입력</legend>
							<h5 class="h_title cont"><strong>지원자 기본정보</strong>
								<small>(필수입력)</small></h5>
							<div class="ui_table">
								<dl>
									<dt>아이디</dt>
									<dd th:text="${memberMap.id}"></dd> <!-- memberMap={phoneNo1=, phoneNo2=, gendDvCd=Male, cartSn=0, name=전지환, residno1=870609, id=pollak2@amore.net, cstmid=990000001, memberSn=157}-->
								</dl>
							</div>
							<div class="dl">
								<dl>
									<dt><label for="phoneCorp">휴대폰</label></dt>
									<dd>
										<div ap:replace="~{customer/fragment/member :: phoneCorp}"></div>
								        <div ap:replace="~{customer/fragment/member :: cellNumWithBtn}"></div>
								        <div ap:replace="~{customer/fragment/member :: smsNumWithBtn}"></div>
										
										<br> <!--/* 03-19 버튼 추가 */-->
										<button type="button" class="btn_md_neutral w100p certification_btn">인증확인</button>
									</dd>
								</dl>
								<dl>
									<dt>생년월일</dt>
									<dd>
										<div class="input_group">
											<div>
												<input type="text" name="dob" id="dob" placeholder="yyyymmdd" psnDtbr="psnDtbr" fourteenOver ="fourteenOver" required="required" data-msg-required="생년월일을 입력해 주세요.">
											</div>
											<div class="btn">
												<select name="genderCode" id="genderCode" title="성별 선택" required="required">
													<option value="" >성별</option>
													<option value="Female" >여자</option>
													<option value="Male" >남자</option>
												</select>
											</div>
										</div>
									</dd>
								</dl>
								<dl>
									<dt>홈페이지(블로그)</dt>
									<dd>
										<div class="input_group">
											<div>
												<input type="text" name="personalHomepageUrl" id="personalHomepageUrl" placeholder="http://" >
											</div>
										</div>
									</dd>
								</dl>
								<dl>
									<dt>SNS 주소</dt>
									<dd>
										<div class="input_group">
											<div>
												<input type="text" name="snsUrl" id="snsUrl" placeholder="http://" required="required" data-msg-required="페이스북을 입력해주세요" >
											</div>
											<div class="btn">
												<button type="button" class="snsUrl">등록</button>
											</div>
										</div>
									</dd>
								</dl>
								<!--/* 20180504 : 거주지역으로 내용 변경 */-->
								<dl>
									<dt><label for="location">거주지역</label></dt>
									<dd class="ui_find_addresses">
										<div class="input_group">
											<div>
												<select name="preLocal" id="preLocal" title="지역 선택" required="required" data-msg-required="거주지역을 선택해 주세요.">
													<option value="">지역 선택</option>
													<option value="강원도">강원도</option>
													<option value="경기도">경기도</option>
													<option value="경상남도">경상남도</option>
													<option value="경상북도">경상북도</option>
													<option value="광주광역시">광주광역시</option>
													<option value="대구광역시">대구광역시</option>
													<option value="대전광역시">대전광역시</option>
													<option value="부산광역시">부산광역시</option>
													<option value="서울특별시">서울특별시</option>
													<option value="세종특별자치시">세종특별자치시</option>
													<option value="울산광역시">울산광역시</option>
													<option value="인천광역시">인천광역시</option>
													<option value="전라남도">전라남도</option>
													<option value="전라북도">전라북도</option>
													<option value="제주특별자치도">제주특별자치도</option>
													<option value="충청남도">충청남도</option>
													<option value="충청북도">충청북도</option>
												</select>
											</div>
										</div>
									</dd>
								</dl>
								
							</div>
							<h5 class="h_title cont"><strong>학력사항</strong>
								<small>(필수입력)</small></h5>
							<div class="input_group">
								<div>
									<input type="text" name="school" id="school" placeholder="학교를 입력해 주세요." required="required" data-msg-required="학교를 입력해 주세요.">
								</div>
								<div class="btn" th:with="gradeList = ${ {'','1','2','3','4'} }">
									<select name="grade" id="grade" title="학년 선택" required="required" data-msg-required="학년을 선택하세요.">
										<option th:each="gradeTerm : ${gradeList}" th:value="${gradeTerm}" th:text="${gradeTerm}+ '학년'"></option>
									</select>
								</div>
							</div>
							<div class="input_group">
								<div>
									<input type="text" id="faculty" name="faculty" placeholder="학과/학부를 입력해 주세요." required="required" data-msg-required="학과/학부를 입력해 주세요.">
								</div>
								<div class="btn" th:with="completeList = ${ {'','1','2','3','4','5','6','7','8','9','10'} }">
									<select name="completeTerm" title="이수학기 선택" required="required" data-msg-required="이수학기를 선택하세요." id="completeTerm">
										<option th:each="termVal : ${completeList}" th:value="${termVal}" th:text="${termVal}+ '학기 이수'"></option> 
									</select>
								</div>
							</div>
							<div class="input_group">
								<div>
									<input type="text" name="major" id="major" placeholder="전공을 입력해 주세요." required="required" data-msg-required="전공을 입력해 주세요.">
								</div>
							</div>
							<div class="form_btns">
								<a href="#none" class="btn_lg_secondary temp">임시저장</a>
								<a href="#none" class="btn_lg_neutral nextConfirm">다음</a>
							</div>
						</fieldset>
						</div>
					</form>
				</div>
			</div>
		</div>
	</div>
</div>

<!--/* 하단 js등을 실행하는 마지막 영역 */-->
<th:block ap:fragment="layout-endpoint">

	<!--/* 예시, 적절한 위치에 옮겨 개발하세요 */-->
	<script th:inline="javascript">
	
		var memberMap = /*[[${memberMap}]]*/;		
		var supportersData = /*[[${supportersInfo}]]*/;
	
	
		//이미지 첨부 적용
		$( '.ui_input_images' ).inputImages();
		
		$( '.form_btns > a' ).on( 'click', function (e) {
			e.preventDefault();

			var formData = new FormData( $('form').get(0) );

			//formDate에 첨부된 이미지 병합
			$( '.ui_input_images' ).inputImages( 'extendFormData', formData );

			//formData를 ajax의 data에 넣어서 보내면 된다.
		});
		
		/** 예약하기 data set ********************************************************************/
		AP.beautizenRecruitReserve.setData( supportersData );

		/** 예약 완료 확인 ************************************************************************/
		AP.beautizenRecruitReserve.addListener( 'reserve-introduce', function (e) {
			AP.login().done(function (e) {
				location.href="/display/beautizen_introduce?displayMenuId=beautizen_introduce";
			}); 
		});
		
		/** 인증요청 *****************************************************************************/
		
		var def_Time = 3,
			def_TimeCnt = 3,
			t = new AP.common.timeCountDown( def_Time ),
			certTimeCnt = 0,
			extTimeCnt = 0;

			//"인증 받기"버튼
			$('#certBtn').on('click', function(e) {
				phoneCertProcess();
			});

			//"재인증"버튼
			$('#reCertBtn').on('click', function(e) {
				extTimeCnt = 0;
				phoneCertProcess();
			});

			//"시간 연장"버튼
			$('#extTimeBtn').on('click', function(e) {
				if (certTimeCnt == 0) {
					AP.modal.alert("인증 먼저 받으세요.");
				} else {
					if (extTimeCnt < def_TimeCnt) {
						//TODO:서버쪽 시간연장 로직 추가 확인
						if (!t.isRunning()) {
							AP.modal.alert("입력시간 초과했습니다. 재인증하세요.");
						} else {
							//3 minutes timer
							if (t.isRunning()) {
								t.stop();
							}
							t.start();
							extTimeCnt++;
						}
					} else {
						AP.modal.alert("시간연장은 3회만 가능합니다.");
					}

				}
			});

			
			function phoneCertProcess() {
				
			   	var $form = $('form.validate');
			   
			   	$('form.validate').validate().settings.ignore = "*";
			    if ($form.valid()) {

			        AP.api.phoneCert({}, AP.common.getFormData($form)).done(function(data) {
			            //성공
			            if (data) {
			            	
		                    AP.modal.alert("인증번호가 전송되었습니다.");
		                    $('#certBtn').hide();
		                    $('#reCertBtn').show();

		                    //3 minutes timer
		                    if (t.isRunning()) {
		                        t.stop();
		                    }
		                    t.start();

		                    certTimeCnt++;
			
			            } else {
			                AP.modal.alert("[ajax.done]실패")
			            }
			        }).fail(function(xhr, textStatus, errorThrown) {

				        if (xhr.errorCode == 0) {
				            AP.modal.alert("인터넷이 연결되지 않습니다. 연결 상태를 확인해주세요.");
				        } else if (xhr.errorCode == 'EAPI001') {
				            var contents = new Object();
				            contents.title = "인증실패";
				            contents.contents = "인증요청에 실패하였습니다. 입력 정보를 다시 한 번 확인해주세요.";
				            contents.confirmLabel = "확인";
				            AP.modal.info(contents).addListener('modal-close', function(e) {});
				        } else {
				            AP.modal.alert(xhr.errorMessage)
				        }
			        }).always(function() {
			            //성공, 실패
			        });

			    }
			}
			
			//"다음"버튼
			$('#stepOne').on('click', function(e) {
			    if (certTimeCnt > 0) {
			        stepOne();
			    } else {
			        AP.modal.alert("인증 먼저 받으세요.");
			    }
			});

			function stepOne() {
			    var $form = $('form.validate');
			    $form.validate().settings.ignore = "";

			    if ($form.valid()) {

			        checkCaptcha(function(data) {

			            if (data == true) {

			                if (!t.isRunning()) {
			                    AP.modal.alert("입력시간 초과했습니다. 재인증하세요.");
			                } else {
			                    AP.api.stepOne({}, AP.common.getFormData($form)).done(function(data) {
			                        //성공
			                        if (data) {

			                            var joinType = data.joinType;
		                                //save in sessionstorage
		                                try {
		                                    var obj = new JoinStepOneObj("complete", joinType, $('[name=custNm]').val(), $('[name=frclCd]').val(), $('[name=sxclCd]').val(), data.chcsNo, data.athtDtbr, data.cellNum, data.custEmid);

		                                    AP.common.setSessionStorage("JoinStepOneObj", obj);

		                                } catch (e) {
		                                    console.log(e.message)
		                                }

		                                switch (joinType) {
		                                    case "00": //이미 가입됨
		                                        AP.modal.alert("이미가입한 회원입니다. 로그인을 하세요.").addListener('modal-close', function(e) {
		                                            window.location = "/login";
		                                        });
		                                        break;
		                                    case "01": //신규가입
		                                        passInfoModal();
		                                        break;
		                                    case "02": //etude구회원 정보
		                                    case "03": //통합가입 구회원 정보
		                                        //전입
		                                        changeInfoModal();
		                                        break;
		                                    case "04": //통합ID회원 정보
		                                    case "05": //통합비ID회원 정보
		                                        passInfoModal();
		                                        break;
		                                    default:
		                                        AP.modal.alert("[System]인증 다시하세요.");
		                                        break;
		                                }

			                        } else {
			                            AP.modal.alert("[ajax.done]실패")
			                        }
			                    }).fail(function(xhr, textStatus, errorThrown) {

					                if (xhr.errorCode == 0) {
					                    AP.modal.alert("인터넷이 연결되지 않습니다. 연결 상태를 확인해주세요.");
					                } else if (xhr.errorCode == 'EAPI001') {
					                    var contents = new Object();
					                    contents.title = "인증실패";
					                    contents.contents = data.message;
					                    contents.confirmLabel = "확인";
					                    AP.modal.info(contents).addListener('modal-close', function(e) {});
					                } else {
					                    AP.modal.alert(xhr.errorMessage)
					                }
			                    }).always(function() {
			                        //성공, 실패
			                    });

			                }

			            } else {
			                AP.modal.alert("자동입력 방지문자를 정확히 입력해주세요.");
			            }
			        });

			    }
			}
			
			//인증성공 안내
			function passInfoModal() {
			    AP.modal.alert("본인인증이 완료되었습니다.").addListener('modal-close', function(e) {
			        window.location = "/customer/agreeTerms";
			    });
			}

			//sessionStorage
			function JoinStepOneObj(stepOne, joinType, custNm, frclCd, sxclCd, chcsNo, athtDtbr, cellNum, custEmid) {
			    this.StepOne = stepOne;
			    this.JoinType = joinType;
			    this.CustNm = custNm;
			    this.FrclCd = frclCd;
			    this.SxclCd = sxclCd;
			    this.ChcsNo = chcsNo;
			    this.AthtDtbr = athtDtbr;
			    this.CellNum = cellNum;
			    this.CustEmid = custEmid;
		}
			
			
	
		
	</script>

</th:block>

</body>
</html>
